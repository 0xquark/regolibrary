package armo_builtins

deny[msga] {
	node := input[_]
    node.kind == "Node"
    kernelVersionMatch := regex.find_all_string_submatch_n("[0-9]+\\.[0-9]+\\.[0-9]+", node.status.nodeInfo.kernelVersion, -1)
    kernelVersion := kernelVersionMatch[0][0]
    
    kernelVersionArr := split(kernelVersion, ".")
    to_number(kernelVersionArr[0]) == 5
    to_number(kernelVersionArr[1]) >= 1
    to_number(kernelVersionArr[1]) <= 16
    to_number(kernelVersionArr[2]) < 2 
    
    node.status.nodeInfo.operatingSystem == "linux"
    path := "status.nodeInfo.kernelVersion"

 	msga := {
			"alertMessage": "You are vulnerable to CVE-2022-0185",
    		"alertObject": {
               "k8SApiObjects": [node]
            },
			"failedPaths": [path],
	}
}